"use client";

import { useEffect, useState } from "react";
import { Moon, Sun } from "lucide-react";

export default function ThemeToggle() {
  const [theme, setTheme] = useState<"light" | "dark">("light");

  useEffect(() => {
    // Load saved theme
    const saved = localStorage.getItem("theme") as "light" | "dark" | null;
    if (saved) {
      setTheme(saved);
      document.documentElement.classList.toggle("dark", saved === "dark");
    } else {
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      document.documentElement.classList.toggle("dark", prefersDark);
      setTheme(prefersDark ? "dark" : "light");
    }

    // Listen for theme changes from other instances
    const handleThemeChange = (e: CustomEvent<"light" | "dark">) => {
      setTheme(e.detail);
    };

    window.addEventListener("themeChange", handleThemeChange as EventListener);
    return () => {
      window.removeEventListener(
        "themeChange",
        handleThemeChange as EventListener
      );
    };
  }, []);

  const toggleTheme = () => {
    const next = theme === "light" ? "dark" : "light";
    setTheme(next);
    localStorage.setItem("theme", next);
    document.documentElement.classList.toggle("dark", next === "dark");

    // Notify other instances
    window.dispatchEvent(new CustomEvent("themeChange", { detail: next }));
  };

  const isChecked = theme === "dark";

  return (
    <>
      <button
        onClick={toggleTheme}
        className="flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors duration-200 mr-10"
      >
        {isChecked ? (
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M16.625 4.75V1.1875C16.625 0.872555 16.7501 0.57051 16.9728 0.347811C17.1955 0.125111 17.4976 0 17.8125 0C18.1274 0 18.4295 0.125111 18.6522 0.347811C18.8749 0.57051 19 0.872555 19 1.1875V4.75C19 5.06494 18.8749 5.36699 18.6522 5.58969C18.4295 5.81239 18.1274 5.9375 17.8125 5.9375C17.4976 5.9375 17.1955 5.81239 16.9728 5.58969C16.7501 5.36699 16.625 5.06494 16.625 4.75ZM27.3125 17.8125C27.3125 19.6914 26.7553 21.5281 25.7115 23.0904C24.6676 24.6527 23.1839 25.8703 21.448 26.5894C19.7121 27.3084 17.802 27.4965 15.9591 27.13C14.1163 26.7634 12.4236 25.8586 11.095 24.53C9.76638 23.2014 8.8616 21.5087 8.49504 19.6659C8.12848 17.823 8.31661 15.9129 9.03564 14.177C9.75467 12.4411 10.9723 10.9574 12.5346 9.91354C14.0968 8.86966 15.9336 8.3125 17.8125 8.3125C20.3312 8.31525 22.746 9.31702 24.527 11.098C26.308 12.879 27.3097 15.2938 27.3125 17.8125ZM24.9375 17.8125C24.9375 16.4033 24.5196 15.0258 23.7367 13.8541C22.9538 12.6824 21.841 11.7691 20.5391 11.2299C19.2372 10.6906 17.8046 10.5495 16.4225 10.8244C15.0404 11.0993 13.7708 11.7779 12.7744 12.7744C11.7779 13.7708 11.0993 15.0404 10.8244 16.4225C10.5495 17.8046 10.6906 19.2372 11.2299 20.5391C11.7691 21.841 12.6824 22.9538 13.8541 23.7367C15.0258 24.5196 16.4033 24.9375 17.8125 24.9375C19.7016 24.9355 21.5127 24.1842 22.8485 22.8485C24.1842 21.5127 24.9355 19.7016 24.9375 17.8125ZM7.47234 9.15265C7.69517 9.37548 7.99738 9.50066 8.3125 9.50066C8.62762 9.50066 8.92983 9.37548 9.15265 9.15265C9.37548 8.92983 9.50066 8.62762 9.50066 8.3125C9.50066 7.99738 9.37548 7.69517 9.15265 7.47234L6.77765 5.09734C6.55483 4.87452 6.25262 4.74934 5.9375 4.74934C5.62238 4.74934 5.32017 4.87452 5.09734 5.09734C4.87452 5.32017 4.74934 5.62238 4.74934 5.9375C4.74934 6.25262 4.87452 6.55483 5.09734 6.77765L7.47234 9.15265ZM7.47234 26.4723L5.09734 28.8473C4.87452 29.0702 4.74934 29.3724 4.74934 29.6875C4.74934 30.0026 4.87452 30.3048 5.09734 30.5277C5.32017 30.7505 5.62238 30.8757 5.9375 30.8757C6.25262 30.8757 6.55483 30.7505 6.77765 30.5277L9.15265 28.1527C9.26299 28.0423 9.3505 27.9113 9.41022 27.7672C9.46993 27.623 9.50066 27.4685 9.50066 27.3125C9.50066 27.1565 9.46993 27.002 9.41022 26.8578C9.3505 26.7137 9.26299 26.5827 9.15265 26.4723C9.04232 26.362 8.91134 26.2745 8.76719 26.2148C8.62303 26.1551 8.46853 26.1243 8.3125 26.1243C8.15647 26.1243 8.00196 26.1551 7.85781 26.2148C7.71365 26.2745 7.58267 26.362 7.47234 26.4723ZM27.3125 9.5C27.4685 9.50012 27.623 9.46951 27.7671 9.40991C27.9113 9.35031 28.0423 9.2629 28.1527 9.15265L30.5277 6.77765C30.7505 6.55483 30.8757 6.25262 30.8757 5.9375C30.8757 5.62238 30.7505 5.32017 30.5277 5.09734C30.3048 4.87452 30.0026 4.74934 29.6875 4.74934C29.3724 4.74934 29.0702 4.87452 28.8473 5.09734L26.4723 7.47234C26.3061 7.63842 26.1928 7.8501 26.1469 8.08057C26.101 8.31105 26.1245 8.54996 26.2145 8.76706C26.3045 8.98416 26.4568 9.16969 26.6523 9.30017C26.8477 9.43064 27.0775 9.50018 27.3125 9.5ZM28.1527 26.4723C27.9298 26.2495 27.6276 26.1243 27.3125 26.1243C26.9974 26.1243 26.6952 26.2495 26.4723 26.4723C26.2495 26.6952 26.1243 26.9974 26.1243 27.3125C26.1243 27.6276 26.2495 27.9298 26.4723 28.1527L28.8473 30.5277C28.9577 30.638 29.0886 30.7255 29.2328 30.7852C29.377 30.8449 29.5315 30.8757 29.6875 30.8757C29.8435 30.8757 29.998 30.8449 30.1422 30.7852C30.2863 30.7255 30.4173 30.638 30.5277 30.5277C30.638 30.4173 30.7255 30.2863 30.7852 30.1422C30.8449 29.998 30.8757 29.8435 30.8757 29.6875C30.8757 29.5315 30.8449 29.377 30.7852 29.2328C30.7255 29.0886 30.638 28.9577 30.5277 28.8473L28.1527 26.4723ZM5.9375 17.8125C5.9375 17.4976 5.81239 17.1955 5.58969 16.9728C5.36699 16.7501 5.06494 16.625 4.75 16.625H1.1875C0.872555 16.625 0.57051 16.7501 0.347811 16.9728C0.125111 17.1955 0 17.4976 0 17.8125C0 18.1274 0.125111 18.4295 0.347811 18.6522C0.57051 18.8749 0.872555 19 1.1875 19H4.75C5.06494 19 5.36699 18.8749 5.58969 18.6522C5.81239 18.4295 5.9375 18.1274 5.9375 17.8125ZM17.8125 29.6875C17.4976 29.6875 17.1955 29.8126 16.9728 30.0353C16.7501 30.258 16.625 30.56 16.625 30.875V34.4375C16.625 34.7524 16.7501 35.0545 16.9728 35.2772C17.1955 35.4999 17.4976 35.625 17.8125 35.625C18.1274 35.625 18.4295 35.4999 18.6522 35.2772C18.8749 35.0545 19 34.7524 19 34.4375V30.875C19 30.56 18.8749 30.258 18.6522 30.0353C18.4295 29.8126 18.1274 29.6875 17.8125 29.6875ZM34.4375 16.625H30.875C30.56 16.625 30.258 16.7501 30.0353 16.9728C29.8126 17.1955 29.6875 17.4976 29.6875 17.8125C29.6875 18.1274 29.8126 18.4295 30.0353 18.6522C30.258 18.8749 30.56 19 30.875 19H34.4375C34.7524 19 35.0545 18.8749 35.2772 18.6522C35.4999 18.4295 35.625 18.1274 35.625 17.8125C35.625 17.4976 35.4999 17.1955 35.2772 16.9728C35.0545 16.7501 34.7524 16.625 34.4375 16.625Z"
              fill="white"
            />
          </svg>
        ) : (
          <svg
            width="30"
            height="30"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M29 16.2613C28.7548 18.9148 27.7589 21.4436 26.129 23.5517C24.499 25.6599 22.3023 27.2603 19.796 28.1656C17.2897 29.0709 14.5774 29.2437 11.9764 28.6637C9.37551 28.0838 6.99353 26.7751 5.10923 24.8908C3.22492 23.0065 1.91623 20.6245 1.33628 18.0236C0.756336 15.4226 0.929121 12.7103 1.83442 10.204C2.73972 7.69767 4.34009 5.50101 6.44827 3.87104C8.55645 2.24107 11.0852 1.24522 13.7387 1C12.1852 3.10176 11.4376 5.69132 11.632 8.29768C11.8263 10.904 12.9497 13.3541 14.7978 15.2022C16.6459 17.0503 19.096 18.1737 21.7023 18.368C24.3087 18.5624 26.8982 17.8148 29 16.2613Z"
              stroke="#1E1E1E"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        )}
      </button>
    </>
  );
}
